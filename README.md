# 前言

本项目是一个学习项目。整体架构基于慕课网仿秒杀网站，同时根据自己的理解，融合了一些常用的中间件技术，方便未来学习和查阅。

项目整体分为用户注册登录，商品查询，商品下单三个模块。

## 技术选型

### 所用工具

工具名称|类型
----|------
SpringBoot | 框架
Mybatis| 持久化框架
Druid|数据库监控连接池
Redis|分布式缓存数据库
RocketMQ|分布式消息队列
FastJson|序列化工具
Guava|工具类
MySQL|数据库
Nginx|负载均衡服务器
Maven|项目构建管理工具

### 项目整体架构图
![image](https://github.com/KArthurL/myMiaosha/blob/master/images/1577351967(1).png)

### 优化措施
本项目的优化主要在商品查询模块和商品下单模块

#### 1.缓存

主要使用Redis储存热点商品对象，避免大量请求直接落在数据库上。

缓存三大常见问题：

**缓存雪崩**:为避免同一时间大范围缓存失效，大量查询请求落在数据库上，在设置缓存失效时间时，添加一个随机因子，避免多个缓存同时失效。

**缓存击穿**：使用谷歌的Guava工具类在应用中实现了二级缓存，除非Redis缓存和Guava缓存同时失效，才有可能造成缓存击穿。

**缓存穿透**：基于Redis和Guava实现了布隆过滤器，在查询商品前截断了不存在于数据库内的查询请求。

#### 2.接口限流
采用开源工具包Guava提供的限流工具类RateLimiter进行接口限流，该类基于"令牌桶算法"。

#### 3.异步下单

使用RocketMQ完成异步下单，通过分布式事务消息二阶段提交，消费端根据全局流水id通过MySQL主键进行幂等去重。下单流程见下图：
![image](https://github.com/KArthurL/myMiaosha/blob/master/images/1577345133(1).png)
### 优化结果
#### 应用部署
后端应用水平部署至两台服务器上；单独部署Nginx实现负载均衡；单独部署Redis共享缓存、布隆过滤器和储存分布式会话。如下图所示：
![image](https://github.com/KArthurL/myMiaosha/blob/master/images/1577346419(1).png)

#### 压测结果
查询Qps：4000
下单Tps：700

